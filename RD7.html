<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Dictation Master - British English</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #58CC02;
            --secondary-color: #1CB0F6;
            --accent-color: #FF4B4B;
            --light-color: #FFFFFF;
            --dark-color: #3C3C3C;
            --gray-color: #E5E5E5;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
        }
        
        body {
            background-color: #F8F9FA;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            background-color: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: 800;
            color: var(--dark-color);
        }
        
        .logo-text span {
            color: var(--primary-color);
        }
        
        .user-stats {
            display: flex;
            gap: 20px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 14px;
            color: #777;
        }
        
        .voice-info {
            background-color: #FFF3CD;
            border: 1px solid #FFEAA7;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .main-content {
            display: flex;
            gap: 25px;
        }
        
        .sidebar {
            flex: 1;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
        }
        
        .round-progress {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .round-item {
            padding: 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid transparent;
        }
        
        .round-item.active {
            background-color: rgba(88, 204, 2, 0.1);
            border-color: var(--primary-color);
        }
        
        .round-item.completed {
            background-color: rgba(88, 204, 2, 0.05);
        }
        
        .round-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--gray-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .round-item.active .round-icon {
            background-color: var(--primary-color);
            color: white;
        }
        
        .round-item.completed .round-icon {
            background-color: var(--primary-color);
            color: white;
        }
        
        .round-info {
            flex: 1;
        }
        
        .round-title {
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .round-desc {
            font-size: 14px;
            color: #777;
        }
        
        .content-area {
            flex: 2;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            min-height: 500px;
        }
        
        .round-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-color);
        }
        
        .round-header h2 {
            color: var(--dark-color);
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .round-header p {
            color: #777;
            font-size: 16px;
        }
        
        .exercise-container {
            padding: 20px 0;
        }
        
        /* Round 1 Styles */
        .word-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .word-item {
            background-color: #F5F9FF;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .word-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: var(--secondary-color);
        }
        
        .word-text {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        
        .word-meaning {
            font-size: 14px;
            color: #777;
            margin-bottom: 15px;
            max-height: 60px;
            overflow: auto;
        }
        
        .speak-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 0 auto;
            transition: background-color 0.3s;
        }
        
        .speak-btn:hover {
            background-color: #0D9CDB;
        }
        
        /* Round 2 Styles */
        .sentence-exercise {
            margin-bottom: 30px;
        }
        
        .sentence {
            font-size: 20px;
            margin-bottom: 20px;
            line-height: 1.8;
            padding: 15px;
            background-color: #F9F9F9;
            border-radius: 12px;
        }
        
        .blank {
            display: inline-block;
            min-width: 120px;
            border-bottom: 2px dashed var(--accent-color);
            margin: 0 5px;
            text-align: center;
            color: transparent;
            position: relative;
            height: 30px;
        }
        
        .blank.has-answer {
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .word-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 30px;
        }
        
        .word-option {
            background-color: #F0F7FF;
            border: 2px solid var(--secondary-color);
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .word-option:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .word-option.used {
            opacity: 0.5;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        /* Round 3 Styles */
        .dictation-container {
            text-align: center;
            padding: 20px;
        }
        
        .dictation-text {
            font-size: 22px;
            margin-bottom: 30px;
            line-height: 1.8;
            background-color: #F9F9F9;
            padding: 20px;
            border-radius: 12px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .voice-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        
        .voice-btn:hover {
            background-color: #4AAE00;
        }
        
        .voice-btn.recording {
            background-color: var(--accent-color);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .result-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            display: none;
        }
        
        .result-message.correct {
            background-color: rgba(88, 204, 2, 0.2);
            color: #2A7A00;
            display: block;
        }
        
        .result-message.incorrect {
            background-color: rgba(255, 75, 75, 0.2);
            color: #CC0000;
            display: block;
        }
        
        /* Round 4 Styles */
        .bonus-words {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .bonus-card {
            background-color: #FFF9E6;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #FFD166;
            transition: transform 0.3s ease;
        }
        
        .bonus-card:hover {
            transform: translateY(-5px);
        }
        
        .bonus-card h4 {
            color: #E6B400;
            font-size: 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bonus-sentence {
            font-style: italic;
            color: #777;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #FFD166;
        }
        
        /* Round 5 Styles - Paragraph Dictation */
        .paragraph-container {
            margin-bottom: 30px;
        }
        
        .paragraph-text {
            font-size: 18px;
            line-height: 1.8;
            background-color: #F9F9F9;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .paragraph-text .highlight {
            background-color: #FFF3CD;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .paragraph-dictation {
            margin-top: 30px;
            padding: 20px;
            background-color: #F0F8FF;
            border-radius: 12px;
        }
        
        .paragraph-dictation h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .paragraph-blank {
            display: inline-block;
            min-width: 100px;
            border-bottom: 2px dashed var(--accent-color);
            margin: 0 5px;
            text-align: center;
            color: transparent;
            position: relative;
            height: 30px;
            vertical-align: middle;
        }
        
        .paragraph-blank.has-answer {
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .paragraph-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .paragraph-option {
            background-color: #E7F4FF;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .paragraph-option:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .paragraph-option.used {
            opacity: 0.5;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--gray-color);
        }
        
        .nav-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.3s;
            font-weight: 600;
        }
        
        .nav-btn:hover {
            background-color: #4AAE00;
        }
        
        .nav-btn:disabled {
            background-color: #CCCCCC;
            cursor: not-allowed;
        }
        
        .nav-btn.prev {
            background-color: #E5E5E5;
            color: var(--dark-color);
        }
        
        .nav-btn.prev:hover {
            background-color: #D5D5D5;
        }
        
        /* Voice Selector */
        .voice-selector {
            margin: 15px 0;
            padding: 10px;
            background-color: #F0F8FF;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .voice-selector label {
            font-weight: 600;
            color: #1a73e8;
        }
        
        .voice-selector select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ccc;
            background-color: white;
            font-size: 14px;
            min-width: 200px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .user-stats {
                display: none;
            }
            
            .word-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .voice-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .voice-selector {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        @media (max-width: 480px) {
            .word-list {
                grid-template-columns: 1fr;
            }
            
            .round-header h2 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">E</div>
                <div class="logo-text">English <span>Dictation</span></div>
            </div>
            <div class="user-stats">
                <div class="stat">
                    <div class="stat-value" id="points">0</div>
                    <div class="stat-label">Points</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="streak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">Level</div>
                </div>
            </div>
        </header>
        
        <div class="voice-info">
            <i class="fas fa-info-circle"></i>
            <span>This app uses British English pronunciation. Make sure your browser supports speech synthesis.</span>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="round-progress">
                    <div class="round-item active" data-round="1">
                        <div class="round-icon">1</div>
                        <div class="round-info">
                            <div class="round-title">New Words</div>
                            <div class="round-desc">Listen and learn new vocabulary</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="2">
                        <div class="round-icon">2</div>
                        <div class="round-info">
                            <div class="round-title">Fill in the Blanks</div>
                            <div class="round-desc">Complete sentences with correct words</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="3">
                        <div class="round-icon">3</div>
                        <div class="round-info">
                            <div class="round-title">Speak & Dictate</div>
                            <div class="round-desc">Practice pronunciation and dictation</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="4">
                        <div class="round-icon">4</div>
                        <div class="round-info">
                            <div class="round-title">Bonus Words</div>
                            <div class="round-desc">Expand your vocabulary further</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="5">
                        <div class="round-icon">5</div>
                        <div class="round-info">
                            <div class="round-title">Paragraph Dictation</div>
                            <div class="round-desc">Listen and complete a short story</div>
                        </div>
                    </div>
                </div>
                
                <div class="voice-selector">
                    <label for="voice-select"><i class="fas fa-volume-up"></i> Voice:</label>
                    <select id="voice-select">
                        <option value="">Loading voices...</option>
                    </select>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Round 1: New Words -->
                <div class="round-header" id="round1-header">
                    <h2>Round 1: Learn New Words</h2>
                    <p>Click on the speaker icon to listen to each word with British English pronunciation.</p>
                </div>
                
                <div class="exercise-container" id="round1-content">
                    <div class="word-list" id="word-list">
                        <!-- Words will be generated here -->
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="nav-btn next" id="next-round1">
                            Next Round <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Round 2: Fill in the blanks -->
                <div class="round-header" id="round2-header" style="display: none;">
                    <h2>Round 2: Fill in the Blanks</h2>
                    <p>Drag and drop the correct words into the blanks to complete the sentences.</p>
                </div>
                
                <div class="exercise-container" id="round2-content" style="display: none;">
                    <div class="sentence-exercise" id="sentence-exercise">
                        <!-- Sentences with blanks will be generated here -->
                    </div>
                    <div class="word-options" id="word-options">
                        <!-- Word options will be generated here -->
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round2">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="nav-btn next" id="next-round2">
                            Next Round <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Round 3: Speak & Dictate -->
                <div class="round-header" id="round3-header" style="display: none;">
                    <h2>Round 3: Speak & Dictate</h2>
                    <p>Listen to the sentence with British English pronunciation and speak it aloud.</p>
                </div>
                
                <div class="exercise-container" id="round3-content" style="display: none;">
                    <div class="dictation-container">
                        <div class="dictation-text" id="dictation-text">
                            We do not need to plan our trip if we go on a guided tour.
                        </div>
                        <div class="voice-controls">
                            <button class="voice-btn" id="listen-btn">
                                <i class="fas fa-volume-up"></i> Listen to Sentence
                            </button>
                            <button class="voice-btn" id="speak-btn">
                                <i class="fas fa-microphone"></i> Start Speaking
                            </button>
                        </div>
                        <div class="result-message" id="result-message"></div>
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round3">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="nav-btn next" id="next-round3">
                            Next Round <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Round 4: Bonus Words -->
                <div class="round-header" id="round4-header" style="display: none;">
                    <h2>Round 4: Bonus Words</h2>
                    <p>Expand your vocabulary with these bonus words and example sentences.</p>
                </div>
                
                <div class="exercise-container" id="round4-content" style="display: none;">
                    <div class="bonus-words" id="bonus-words">
                        <!-- Bonus words will be generated here -->
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round4">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="nav-btn next" id="next-round4">
                            Next Round <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Round 5: Paragraph Dictation -->
                <div class="round-header" id="round5-header" style="display: none;">
                    <h2>Round 5: Paragraph Dictation</h2>
                    <p>Listen to the paragraph and fill in the blanks with the correct words.</p>
                </div>
                
                <div class="exercise-container" id="round5-content" style="display: none;">
                    <div class="paragraph-container">
                        <div class="paragraph-text" id="paragraph-text">
                            <!-- Paragraph will be generated here -->
                        </div>
                        
                        <div class="voice-controls">
                            <button class="voice-btn" id="listen-paragraph-btn">
                                <i class="fas fa-volume-up"></i> Listen to Paragraph
                            </button>
                        </div>
                        
                        <div class="paragraph-dictation">
                            <h3>Fill in the blanks in the paragraph below:</h3>
                            <div id="paragraph-with-blanks">
                                <!-- Paragraph with blanks will be generated here -->
                            </div>
                            <div class="paragraph-options" id="paragraph-options">
                                <!-- Word options will be generated here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round5">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="nav-btn" id="finish-btn">
                            Finish Lesson <i class="fas fa-trophy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application data - Updated with ALL new words from all images
        const appData = {
            currentRound: 1,
            points: 0,
            streak: 1,
            level: 1,
            // All words from all images (11 words total) + 5 additional words
            words: [
                { word: "go on a guided tour", meaning: "We do not need to plan our trip if we go on a guided tour." },
                { word: "ride on a banana boat", meaning: "I like water sports. I want to ride on a banana boat in Thailand." },
                { word: "visit a zoo", meaning: "Kelly visited a zoo last summer. She saw many different animals." },
                { word: "visit a palace", meaning: "I want to visit a palace in England. The kings used to live there." },
                { word: "go sightseeing", meaning: "We go sightseeing when we travel in different countries." },
                { word: "go snowboarding", meaning: "Ken wants to go snowboarding. He thinks it is challenging." },
                { word: "go on a cruise", meaning: "Tourists like going on a cruise. They think it is relaxing." },
                { word: "visit a theme park", meaning: "Tourists like visiting theme parks such as Hong Kong Disneyland." },
                { word: "feed a kangaroo", meaning: "We can feed a kangaroo in Australia." },
                { word: "go skiing", meaning: "Alan went skiing in winter last year." },
                { word: "go into a rainforest", meaning: "Let's go into a rainforest and look at special plants there." }
            ],
            // Sentences for fill in the blanks (Round 2)
            sentences: [
                "We do not need to plan our trip if we __________.",
                "I like water sports. I want to __________ in Thailand.",
                "Kelly __________ last summer. She saw many different animals.",
                "I want to __________ in England. The kings used to live there.",
                "We __________ when we travel in different countries.",
                "Ken wants to __________. He thinks it is challenging.",
                "Tourists like __________. They think it is relaxing.",
                "Tourists like __________ such as Hong Kong Disneyland.",
                "We can __________ in Australia.",
                "Alan __________ in winter last year.",
                "Let's __________ and look at special plants there."
            ],
            // Sentences for dictation (Round 3)
            dictationSentences: [
                "We do not need to plan our trip if we go on a guided tour.",
                "I like water sports. I want to ride on a banana boat in Thailand.",
                "Kelly visited a zoo last summer. She saw many different animals.",
                "I want to visit a palace in England. The kings used to live there.",
                "We go sightseeing when we travel in different countries.",
                "Ken wants to go snowboarding. He thinks it is challenging.",
                "Tourists like going on a cruise. They think it is relaxing.",
                "Tourists like visiting theme parks such as Hong Kong Disneyland.",
                "We can feed a kangaroo in Australia.",
                "Alan went skiing in winter last year.",
                "Let's go into a rainforest and look at special plants there."
            ],
            // Bonus words for Round 4
            bonusWords: [
                { word: "go hiking", sentence: "On weekends, we like to go hiking in the mountains near our city." },
                { word: "try local food", sentence: "When traveling, it's important to try local food to experience the culture." },
                { word: "take photos", sentence: "Tourists often take photos of famous landmarks to remember their trips." },
                { word: "buy souvenirs", sentence: "We always buy souvenirs for our friends and family when we travel." }
            ],
            // Paragraph for Round 5
            paragraph: {
                title: "A Delightful Dinner",
                text: "I was thrilled to experience Thai cuisine in Mong Kok with my friends last night. We decided to order a variety of dishes to share together. Mark chose the spicy green curry, while Sally opted for the tasty spring rolls. As for me, I couldn't resist ordering my favorite Tom Yum Goong soup and a delightful slice of mango sticky rice. We had a fantastic meal together.",
                wordCount: 70,
                blanks: [
                    { word: "thrilled", hint: "very excited" },
                    { word: "cuisine", hint: "style of cooking" },
                    { word: "variety", hint: "different types" },
                    { word: "spicy", hint: "hot flavor" },
                    { word: "tasty", hint: "delicious" },
                    { word: "delightful", hint: "very pleasant" },
                    { word: "fantastic", hint: "excellent" }
                ]
            }
        };
        
        // DOM elements
        const pointsElement = document.getElementById('points');
        const streakElement = document.getElementById('streak');
        const levelElement = document.getElementById('level');
        const roundItems = document.querySelectorAll('.round-item');
        const roundHeaders = document.querySelectorAll('.round-header');
        const roundContents = document.querySelectorAll('.exercise-container');
        const voiceSelect = document.getElementById('voice-select');
        
        // Variables for speech synthesis
        let voices = [];
        let britishVoice = null;
        let selectedVoice = null;
        
        // Initialize the app
        function initApp() {
            updateStats();
            loadRound1();
            setupEventListeners();
            
            // Load voices when they become available
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
            
            // Load voices immediately if they're already available
            if (speechSynthesis.getVoices().length > 0) {
                loadVoices();
            }
        }
        
        // Load available voices
        function loadVoices() {
            // Get available voices
            voices = speechSynthesis.getVoices();
            
            // Clear voice select
            voiceSelect.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a voice...';
            voiceSelect.appendChild(defaultOption);
            
            // Filter for British English voices
            const britishVoices = voices.filter(voice => 
                voice.lang.startsWith('en-GB') || 
                voice.name.toLowerCase().includes('british') ||
                voice.name.toLowerCase().includes('uk')
            );
            
            // Add British voices first
            if (britishVoices.length > 0) {
                const britishGroup = document.createElement('optgroup');
                britishGroup.label = 'British English Voices';
                
                britishVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    britishGroup.appendChild(option);
                    
                    // Set as default British voice
                    if (!britishVoice && voice.lang.startsWith('en-GB')) {
                        britishVoice = voice;
                        option.selected = true;
                        selectedVoice = voice;
                    }
                });
                
                voiceSelect.appendChild(britishGroup);
            }
            
            // Add other English voices
            const otherEnglishVoices = voices.filter(voice => 
                voice.lang.startsWith('en-') && 
                !voice.lang.startsWith('en-GB') &&
                !britishVoices.includes(voice)
            );
            
            if (otherEnglishVoices.length > 0) {
                const otherGroup = document.createElement('optgroup');
                otherGroup.label = 'Other English Voices';
                
                otherEnglishVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    otherGroup.appendChild(option);
                });
                
                voiceSelect.appendChild(otherGroup);
            }
            
            // If no voices found
            if (voices.length === 0) {
                const noVoiceOption = document.createElement('option');
                noVoiceOption.value = '';
                noVoiceOption.textContent = 'No voices available';
                voiceSelect.appendChild(noVoiceOption);
            }
            
            // Add event listener for voice selection
            voiceSelect.addEventListener('change', function() {
                const voiceName = this.value;
                selectedVoice = voices.find(voice => voice.name === voiceName);
            });
        }
        
        // Update user stats
        function updateStats() {
            pointsElement.textContent = appData.points;
            streakElement.textContent = appData.streak;
            levelElement.textContent = appData.level;
        }
        
        // Load Round 1: New Words - Now with ALL 11 words
        function loadRound1() {
            const wordList = document.getElementById('word-list');
            wordList.innerHTML = '';
            
            // Show ALL 11 words
            appData.words.forEach((wordObj, index) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.innerHTML = `
                    <div class="word-text">${wordObj.word}</div>
                    <div class="word-meaning">${wordObj.meaning}</div>
                    <button class="speak-btn" data-word="${wordObj.word}">
                        <i class="fas fa-volume-up"></i> Speak Word
                    </button>
                `;
                wordList.appendChild(wordItem);
            });
            
            // Add event listeners to speak buttons
            document.querySelectorAll('.speak-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const word = this.getAttribute('data-word');
                    speakWord(word);
                    // Add points for interaction
                    addPoints(5);
                });
            });
        }
        
        // Load Round 2: Fill in the blanks
        function loadRound2() {
            const sentenceExercise = document.getElementById('sentence-exercise');
            const wordOptions = document.getElementById('word-options');
            
            sentenceExercise.innerHTML = '';
            wordOptions.innerHTML = '';
            
            // Create pairs of words and sentences (using first 8 words for variety)
            let pairs = [];
            for (let i = 0; i < 8; i++) {
                pairs.push({
                    word: appData.words[i].word,
                    sentence: appData.sentences[i]
                });
            }
            
            // Shuffle pairs for this round
            pairs = pairs.sort(() => Math.random() - 0.5);
            
            // Create sentences with blanks
            pairs.forEach((pair, index) => {
                const sentence = pair.sentence;
                const word = pair.word;
                const blankId = `blank-${index}`;
                
                const sentenceElement = document.createElement('div');
                sentenceElement.className = 'sentence-item';
                sentenceElement.innerHTML = sentence.replace('__________', `<span class="blank" id="${blankId}" data-answer="${word}">__________</span>`);
                sentenceExercise.appendChild(sentenceElement);
                
                // Add word option
                const wordOption = document.createElement('div');
                wordOption.className = 'word-option';
                wordOption.textContent = word;
                wordOption.setAttribute('data-word', word);
                wordOptions.appendChild(wordOption);
            });
            
            // Add event listeners to word options
            document.querySelectorAll('.word-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('used')) return;
                    
                    const word = this.getAttribute('data-word');
                    const blank = document.querySelector(`.blank[data-answer="${word}"]`);
                    
                    if (blank && !blank.classList.contains('has-answer')) {
                        blank.textContent = word;
                        blank.classList.add('has-answer');
                        this.classList.add('used');
                        
                        // Check if all blanks are filled
                        checkAllBlanksFilled();
                        addPoints(10);
                    }
                });
            });
        }
        
        // Check if all blanks are filled
        function checkAllBlanksFilled() {
            const blanks = document.querySelectorAll('.blank');
            const allFilled = Array.from(blanks).every(blank => blank.classList.contains('has-answer'));
            
            if (allFilled) {
                // Show success message
                setTimeout(() => {
                    alert('Great job! All sentences are completed correctly!');
                    addPoints(25);
                }, 300);
            }
        }
        
        // Load Round 3: Speak & Dictate
        function loadRound3() {
            const dictationText = document.getElementById('dictation-text');
            // Use random sentence from all dictation sentences
            const randomIndex = Math.floor(Math.random() * appData.dictationSentences.length);
            dictationText.textContent = appData.dictationSentences[randomIndex];
            dictationText.setAttribute('data-sentence', appData.dictationSentences[randomIndex]);
            
            // Reset result message
            const resultMessage = document.getElementById('result-message');
            resultMessage.className = 'result-message';
            resultMessage.textContent = '';
            resultMessage.style.display = 'none';
        }
        
        // Load Round 4: Bonus Words
        function loadRound4() {
            const bonusWordsContainer = document.getElementById('bonus-words');
            bonusWordsContainer.innerHTML = '';
            
            // Show bonus words
            appData.bonusWords.forEach(bonusWord => {
                const bonusCard = document.createElement('div');
                bonusCard.className = 'bonus-card';
                bonusCard.innerHTML = `
                    <h4><i class="fas fa-star"></i> ${bonusWord.word}</h4>
                    <div class="bonus-sentence">"${bonusWord.sentence}"</div>
                    <button class="speak-btn" data-word="${bonusWord.word}" style="margin-top: 15px;">
                        <i class="fas fa-volume-up"></i> Speak Word
                    </button>
                `;
                bonusWordsContainer.appendChild(bonusCard);
            });
            
            // Add event listeners to speak buttons
            document.querySelectorAll('.bonus-card .speak-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const word = this.getAttribute('data-word');
                    speakWord(word);
                    addPoints(5);
                });
            });
        }
        
        // Load Round 5: Paragraph Dictation
        function loadRound5() {
            const paragraphText = document.getElementById('paragraph-text');
            const paragraphWithBlanks = document.getElementById('paragraph-with-blanks');
            const paragraphOptions = document.getElementById('paragraph-options');
            
            // Display the full paragraph
            paragraphText.innerHTML = `
                <h3>${appData.paragraph.title}</h3>
                <p>${appData.paragraph.text}</p>
                <p style="margin-top: 10px; font-size: 14px; color: #777;">(${appData.paragraph.wordCount} words)</p>
            `;
            
            // Create paragraph with blanks
            let paragraphWithBlanksText = appData.paragraph.text;
            paragraphOptions.innerHTML = '';
            
            // Create word options from the blanks
            const blankWords = [];
            
            appData.paragraph.blanks.forEach((blank, index) => {
                // Replace the word with a blank
                const regex = new RegExp(`\\b${blank.word}\\b`, 'i');
                paragraphWithBlanksText = paragraphWithBlanksText.replace(regex, `<span class="paragraph-blank" id="paragraph-blank-${index}" data-answer="${blank.word}">__________</span>`);
                
                // Add to word options
                blankWords.push({
                    word: blank.word,
                    hint: blank.hint
                });
            });
            
            // Display paragraph with blanks
            paragraphWithBlanks.innerHTML = `<p>${paragraphWithBlanksText}</p>`;
            
            // Shuffle word options
            const shuffledWords = [...blankWords].sort(() => Math.random() - 0.5);
            
            // Create word options
            shuffledWords.forEach((wordObj, index) => {
                const wordOption = document.createElement('div');
                wordOption.className = 'paragraph-option';
                wordOption.innerHTML = `
                    <div>${wordObj.word}</div>
                    <div style="font-size: 12px; font-weight: normal; color: #666;">${wordObj.hint}</div>
                `;
                wordOption.setAttribute('data-word', wordObj.word);
                paragraphOptions.appendChild(wordOption);
            });
            
            // Add event listeners to word options
            document.querySelectorAll('.paragraph-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('used')) return;
                    
                    const word = this.getAttribute('data-word');
                    const blank = document.querySelector(`.paragraph-blank[data-answer="${word}"]`);
                    
                    if (blank && !blank.classList.contains('has-answer')) {
                        blank.textContent = word;
                        blank.classList.add('has-answer');
                        this.classList.add('used');
                        
                        // Check if all blanks are filled
                        checkParagraphBlanksFilled();
                        addPoints(15);
                    }
                });
            });
        }
        
        // Check if all paragraph blanks are filled
        function checkParagraphBlanksFilled() {
            const blanks = document.querySelectorAll('.paragraph-blank');
            const allFilled = Array.from(blanks).every(blank => blank.classList.contains('has-answer'));
            
            if (allFilled) {
                // Show success message
                setTimeout(() => {
                    alert('Excellent! You have completed the paragraph dictation!');
                    addPoints(50);
                }, 300);
            }
        }
        
        // Speak a word using Web Speech API with British English accent
        function speakWord(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to use British English voice if available
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                } else if (britishVoice) {
                    utterance.voice = britishVoice;
                } else {
                    // Fallback to any English voice
                    const englishVoices = voices.filter(voice => voice.lang.startsWith('en-'));
                    if (englishVoices.length > 0) {
                        utterance.voice = englishVoices[0];
                    }
                }
                
                // Set British English pronunciation
                utterance.lang = 'en-GB';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                speechSynthesis.speak(utterance);
            } else {
                alert("Your browser doesn't support speech synthesis. Try Chrome or Edge.");
            }
        }
        
        // Speak a sentence
        function speakSentence() {
            const dictationText = document.getElementById('dictation-text');
            const sentence = dictationText.getAttribute('data-sentence');
            speakWord(sentence);
        }
        
        // Speak the paragraph
        function speakParagraph() {
            speakWord(appData.paragraph.text);
        }
        
        // Setup speech recognition for Round 3
        function setupSpeechRecognition() {
            const speakBtn = document.getElementById('speak-btn');
            const resultMessage = document.getElementById('result-message');
            const dictationText = document.getElementById('dictation-text');
            const targetSentence = dictationText.getAttribute('data-sentence').toLowerCase();
            
            // Check if browser supports speech recognition
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                speakBtn.disabled = true;
                speakBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Speech Not Supported';
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = 'en-GB'; // Use British English for recognition
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            speakBtn.addEventListener('click', function() {
                if (speakBtn.classList.contains('recording')) {
                    recognition.stop();
                    speakBtn.classList.remove('recording');
                    speakBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Speaking';
                    return;
                }
                
                speakBtn.classList.add('recording');
                speakBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Stop Recording';
                resultMessage.style.display = 'none';
                
                recognition.start();
            });
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase();
                speakBtn.classList.remove('recording');
                speakBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Speaking';
                
                // Simple comparison (in a real app, you'd want more sophisticated matching)
                const similarity = calculateSimilarity(transcript, targetSentence);
                
                if (similarity > 0.7) {
                    resultMessage.textContent = `Excellent! You said: "${transcript}"`;
                    resultMessage.className = 'result-message correct';
                    resultMessage.style.display = 'block';
                    addPoints(30);
                    levelUp();
                } else {
                    resultMessage.textContent = `Good try! You said: "${transcript}". The correct sentence is: "${targetSentence}"`;
                    resultMessage.className = 'result-message incorrect';
                    resultMessage.style.display = 'block';
                    addPoints(10);
                }
            };
            
            recognition.onerror = function(event) {
                speakBtn.classList.remove('recording');
                speakBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Speaking';
                resultMessage.textContent = 'Error occurred in recognition: ' + event.error;
                resultMessage.className = 'result-message incorrect';
                resultMessage.style.display = 'block';
            };
        }
        
        // Simple similarity calculation (for demo purposes)
        function calculateSimilarity(str1, str2) {
            const words1 = str1.split(' ');
            const words2 = str2.split(' ');
            
            const commonWords = words1.filter(word => words2.includes(word)).length;
            const maxWords = Math.max(words1.length, words2.length);
            
            return commonWords / maxWords;
        }
        
        // Add points to user
        function addPoints(points) {
            appData.points += points;
            pointsElement.textContent = appData.points;
            
            // Animate points
            pointsElement.style.transform = 'scale(1.2)';
            setTimeout(() => {
                pointsElement.style.transform = 'scale(1)';
            }, 300);
        }
        
        // Level up user
        function levelUp() {
            if (appData.points >= appData.level * 100) {
                appData.level++;
                levelElement.textContent = appData.level;
                
                // Animate level
                levelElement.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    levelElement.style.transform = 'scale(1)';
                }, 300);
                
                // Show level up message
                setTimeout(() => {
                    alert(`Congratulations! You've reached level ${appData.level}!`);
                }, 500);
            }
        }
        
        // Change round
        function changeRound(roundNumber) {
            // Update current round
            appData.currentRound = roundNumber;
            
            // Update round progress UI
            roundItems.forEach(item => {
                item.classList.remove('active');
                const itemRound = parseInt(item.getAttribute('data-round'));
                
                if (itemRound < roundNumber) {
                    item.classList.add('completed');
                } else if (itemRound === roundNumber) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('completed');
                }
            });
            
            // Show/hide round content
            roundHeaders.forEach(header => {
                header.style.display = 'none';
            });
            
            roundContents.forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(`round${roundNumber}-header`).style.display = 'block';
            document.getElementById(`round${roundNumber}-content`).style.display = 'block';
            
            // Load round-specific content
            switch(roundNumber) {
                case 1:
                    loadRound1();
                    break;
                case 2:
                    loadRound2();
                    break;
                case 3:
                    loadRound3();
                    setTimeout(setupSpeechRecognition, 100);
                    break;
                case 4:
                    loadRound4();
                    break;
                case 5:
                    loadRound5();
                    break;
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Round navigation in sidebar
            roundItems.forEach(item => {
                item.addEventListener('click', function() {
                    const roundNumber = parseInt(this.getAttribute('data-round'));
                    if (roundNumber <= appData.currentRound || roundNumber === appData.currentRound + 1) {
                        changeRound(roundNumber);
                    }
                });
            });
            
            // Next/Previous buttons
            document.getElementById('next-round1').addEventListener('click', () => changeRound(2));
            document.getElementById('prev-round2').addEventListener('click', () => changeRound(1));
            document.getElementById('next-round2').addEventListener('click', () => changeRound(3));
            document.getElementById('prev-round3').addEventListener('click', () => changeRound(2));
            document.getElementById('next-round3').addEventListener('click', () => changeRound(4));
            document.getElementById('prev-round4').addEventListener('click', () => changeRound(3));
            document.getElementById('next-round4').addEventListener('click', () => changeRound(5));
            document.getElementById('prev-round5').addEventListener('click', () => changeRound(4));
            
            // Finish button
            document.getElementById('finish-btn').addEventListener('click', function() {
                addPoints(50);
                appData.streak++;
                streakElement.textContent = appData.streak;
                
                alert('Congratulations! You have completed the lesson. You earned 50 bonus points!');
                
                // Reset to round 1
                setTimeout(() => {
                    changeRound(1);
                    loadRound1();
                }, 1000);
            });
            
            // Listen button for round 3
            document.getElementById('listen-btn').addEventListener('click', speakSentence);
            
            // Listen button for round 5
            document.getElementById('listen-paragraph-btn').addEventListener('click', speakParagraph);
        }
        
        // Initialize the app when page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
