<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Dictation Master - British English</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --light-color: #FFFFFF;
            --dark-color: #333333;
            --gray-color: #F5F5F5;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --border-radius: 10px;
            --card-bg: #FFFFFF;
            --xp-color: #9C27B0;
            --skip-color: #757575;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background-color: white;
            color: var(--primary-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .logo-text {
            font-size: 28px;
            font-weight: 800;
        }
        
        .logo-text span {
            font-weight: 300;
        }
        
        .user-stats {
            display: flex;
            gap: 25px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            min-width: 80px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .xp-badge {
            background-color: var(--xp-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            flex: 0 0 300px;
            background-color: #2C3E50;
            color: white;
            padding: 30px 20px;
        }
        
        .round-progress {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .round-item {
            padding: 18px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .round-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .round-item.active {
            background-color: var(--primary-color);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .round-item.completed {
            background-color: rgba(76, 175, 80, 0.7);
        }
        
        .round-item.skipped {
            background-color: rgba(117, 117, 117, 0.5);
            opacity: 0.8;
        }
        
        .round-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .round-item.active .round-icon {
            background-color: white;
            color: var(--primary-color);
        }
        
        .round-item.completed .round-icon {
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--primary-color);
        }
        
        .round-item.skipped .round-icon {
            background-color: rgba(255, 255, 255, 0.5);
            color: var(--skip-color);
        }
        
        .round-info {
            flex: 1;
        }
        
        .round-title {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .round-desc {
            font-size: 13px;
            opacity: 0.8;
        }
        
        .completion-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-color);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .content-area {
            flex: 1;
            padding: 30px;
            background-color: var(--gray-color);
        }
        
        .round-header {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .round-header-info {
            flex: 1;
        }
        
        .round-header h2 {
            color: var(--dark-color);
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .round-header h2 i {
            color: var(--primary-color);
        }
        
        .round-header p {
            color: #666;
            font-size: 16px;
            max-width: 800px;
        }
        
        .round-stats {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px 20px;
            box-shadow: var(--shadow);
            min-width: 200px;
        }
        
        .round-stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .round-stat-label {
            color: #666;
        }
        
        .round-stat-value {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .xp-earned {
            color: var(--xp-color);
            font-weight: 700;
        }
        
        .exercise-container {
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        /* Round 1 Styles */
        .word-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .word-item {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: var(--shadow);
        }
        
        .word-item:hover {
            transform: translateY(-5px);
            border-color: var(--secondary-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .word-text {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark-color);
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .word-meaning {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            min-height: 60px;
            overflow: auto;
            font-style: italic;
        }
        
        .word-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .speak-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .speak-btn:hover {
            background-color: #0D8BF0;
            transform: translateY(-2px);
        }
        
        .speak-btn.sentence-btn {
            background-color: var(--accent-color);
        }
        
        .speak-btn.sentence-btn:hover {
            background-color: #F57C00;
        }
        
        /* Round 2 Styles */
        .sentence-exercise {
            margin-bottom: 30px;
        }
        
        .sentence {
            font-size: 20px;
            margin-bottom: 20px;
            line-height: 1.8;
            padding: 20px;
            background-color: #F8F9FA;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }
        
        .blank {
            display: inline-block;
            min-width: 150px;
            border-bottom: 2px dashed var(--accent-color);
            margin: 0 5px;
            text-align: center;
            color: transparent;
            position: relative;
            height: 35px;
            vertical-align: middle;
        }
        
        .blank.has-answer {
            color: var(--dark-color);
            font-weight: 600;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .word-options-container {
            background-color: #F8F9FA;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }
        
        .word-options-container h4 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .word-options {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .word-option {
            background-color: white;
            border: 2px solid var(--secondary-color);
            border-radius: 25px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--secondary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .word-option:hover {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .word-option.used {
            opacity: 0.4;
            cursor: not-allowed;
            text-decoration: line-through;
            transform: none;
            box-shadow: none;
        }
        
        .word-option.used:hover {
            background-color: white;
            color: var(--secondary-color);
        }
        
        /* Round 3 Styles */
        .dictation-container {
            text-align: center;
            padding: 20px;
        }
        
        .sentence-progress {
            margin-bottom: 20px;
            padding: 12px;
            background-color: #E3F2FD;
            border-radius: var(--border-radius);
            font-size: 16px;
            color: var(--secondary-color);
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dictation-text {
            font-size: 22px;
            margin-bottom: 30px;
            line-height: 1.8;
            background-color: #F8F9FA;
            padding: 25px;
            border-radius: var(--border-radius);
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-left: 4px solid var(--accent-color);
        }
        
        .sentence-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .sentence-control-btn {
            background-color: #9C27B0;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            font-weight: 600;
            min-width: 180px;
        }
        
        .sentence-control-btn:hover {
            background-color: #7B1FA2;
            transform: translateY(-2px);
        }
        
        .sentence-control-btn:disabled {
            background-color: #CCCCCC;
            cursor: not-allowed;
            transform: none;
        }
        
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .voice-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 14px 25px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            font-weight: 600;
            min-width: 200px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        .voice-btn:hover {
            background-color: #3D8B40;
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.15);
        }
        
        .voice-btn.recording {
            background-color: #F44336;
            animation: pulse 1.5s infinite;
        }
        
        .voice-btn.stop-btn {
            background-color: #FF9800;
        }
        
        .voice-btn.stop-btn:hover {
            background-color: #F57C00;
        }
        
        .voice-btn.pause-btn {
            background-color: #9C27B0;
        }
        
        .voice-btn.pause-btn:hover {
            background-color: #7B1FA2;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .result-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--border-radius);
            font-weight: 600;
            display: none;
        }
        
        .result-message.correct {
            background-color: #E8F5E9;
            color: #2E7D32;
            display: block;
            border-left: 4px solid #4CAF50;
        }
        
        .result-message.incorrect {
            background-color: #FFEBEE;
            color: #C62828;
            display: block;
            border-left: 4px solid #F44336;
        }
        
        /* Round 4 Styles */
        .bonus-words {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .bonus-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            transition: transform 0.3s ease;
            box-shadow: var(--shadow);
            border-top: 4px solid #FFD166;
        }
        
        .bonus-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .bonus-card h4 {
            color: #E6B400;
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bonus-sentence {
            color: #666;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #FFD166;
            font-style: italic;
        }
        
        /* Round 5 Styles - Paragraph Dictation */
        .paragraph-container {
            margin-bottom: 30px;
        }
        
        .paragraph-text {
            font-size: 18px;
            line-height: 1.8;
            background-color: #F8F9FA;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .paragraph-dictation {
            margin-top: 30px;
            padding: 25px;
            background-color: #E3F2FD;
            border-radius: var(--border-radius);
        }
        
        .paragraph-dictation h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .paragraph-blank {
            display: inline-block;
            min-width: 120px;
            border-bottom: 2px dashed var(--accent-color);
            margin: 0 5px;
            text-align: center;
            color: transparent;
            position: relative;
            height: 35px;
            vertical-align: middle;
        }
        
        .paragraph-blank.has-answer {
            color: var(--dark-color);
            font-weight: 600;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .paragraph-options-container {
            margin-top: 25px;
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
        }
        
        .paragraph-options-container h4 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .paragraph-options {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .paragraph-option {
            background-color: white;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            padding: 12px 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .paragraph-option:hover {
            background-color: var(--secondary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .paragraph-option.used {
            opacity: 0.4;
            cursor: not-allowed;
            text-decoration: line-through;
            transform: none;
            box-shadow: none;
        }
        
        .paragraph-option.used:hover {
            background-color: white;
            color: var(--secondary-color);
        }
        
        /* Navigation */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #E0E0E0;
        }
        
        .nav-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        .nav-btn:hover {
            background-color: #3D8B40;
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.15);
        }
        
        .nav-btn:disabled {
            background-color: #CCCCCC;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .nav-btn.prev {
            background-color: #757575;
        }
        
        .nav-btn.prev:hover {
            background-color: #616161;
        }
        
        .nav-btn.skip {
            background-color: var(--skip-color);
            margin-left: 10px;
        }
        
        .nav-btn.skip:hover {
            background-color: #5d5d5d;
        }
        
        .nav-buttons-group {
            display: flex;
            gap: 10px;
        }
        
        /* Custom Modal for messages */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }
        
        .modal-overlay.active .modal {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .modal-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .modal-content {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #666;
        }
        
        .modal-stats {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .modal-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .modal-stat-label {
            color: #666;
        }
        
        .modal-stat-value {
            font-weight: 600;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .modal-btn:hover {
            background-color: #3D8B40;
        }
        
        .modal-btn.secondary {
            background-color: #757575;
        }
        
        .modal-btn.secondary:hover {
            background-color: #616161;
        }
        
        /* Skip confirmation modal */
        .skip-confirmation {
            max-width: 400px;
        }
        
        .skip-warning {
            background-color: #FFF3E0;
            border-left: 4px solid #FF9800;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        /* Voice Selector */
        .voice-selector {
            margin: 20px 0;
            padding: 15px;
            background-color: #E3F2FD;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .voice-selector label {
            font-weight: 600;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .voice-selector select {
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #BBDEFB;
            background-color: white;
            font-size: 14px;
            min-width: 250px;
            color: var(--dark-color);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                flex: none;
                width: 100%;
            }
            
            .round-progress {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .round-item {
                flex: 1;
                min-width: 200px;
            }
            
            .round-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .round-stats {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .user-stats {
                width: 100%;
                justify-content: center;
            }
            
            .word-list, .bonus-words {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .voice-controls, .sentence-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .voice-btn, .sentence-control-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .voice-selector {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .voice-selector select {
                width: 100%;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-buttons-group {
                width: 100%;
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .round-item {
                min-width: 100%;
            }
            
            .word-list, .bonus-words {
                grid-template-columns: 1fr;
            }
            
            .round-header h2 {
                font-size: 24px;
            }
            
            .voice-btn, .sentence-control-btn {
                min-width: auto;
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .stat {
                min-width: 70px;
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">E</div>
                <div class="logo-text">English <span>Dictation</span></div>
            </div>
            <div class="user-stats">
                <div class="stat">
                    <div class="stat-value" id="points">0</div>
                    <div class="stat-label">Points</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="total-xp">0</div>
                    <div class="stat-label">Total XP</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="level">1</div>
                    <div class="stat-label">Level</div>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="round-progress">
                    <div class="round-item active" data-round="1">
                        <div class="round-icon">1</div>
                        <div class="round-info">
                            <div class="round-title">New Words</div>
                            <div class="round-desc">Listen and learn new vocabulary</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="2">
                        <div class="round-icon">2</div>
                        <div class="round-info">
                            <div class="round-title">Fill in the Blanks</div>
                            <div class="round-desc">Complete sentences with correct words</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="3">
                        <div class="round-icon">3</div>
                        <div class="round-info">
                            <div class="round-title">Speak & Dictate</div>
                            <div class="round-desc">Practice pronunciation and dictation</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="4">
                        <div class="round-icon">4</div>
                        <div class="round-info">
                            <div class="round-title">Bonus Words</div>
                            <div class="round-desc">Expand your vocabulary further</div>
                        </div>
                    </div>
                    <div class="round-item" data-round="5">
                        <div class="round-icon">5</div>
                        <div class="round-info">
                            <div class="round-title">Paragraph Dictation</div>
                            <div class="round-desc">Listen and complete a short story</div>
                        </div>
                    </div>
                </div>
                
                <div class="voice-selector">
                    <label for="voice-select"><i class="fas fa-volume-up"></i> Voice:</label>
                    <select id="voice-select">
                        <option value="">Loading voices...</option>
                    </select>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Round 1: New Words -->
                <div class="round-header" id="round1-header">
                    <div class="round-header-info">
                        <h2><i class="fas fa-book"></i> Round 1: Learn New Words</h2>
                        <p>Click on the speaker icon to listen to each word with British English pronunciation.</p>
                    </div>
                    <div class="round-stats">
                        <div class="round-stat-item">
                            <span class="round-stat-label">Completed:</span>
                            <span class="round-stat-value" id="round1-completed">0 times</span>
                        </div>
                        <div class="round-stat-item">
                            <span class="round-stat-label">XP Earned:</span>
                            <span class="round-stat-value xp-earned" id="round1-xp">0 XP</span>
                        </div>
                    </div>
                </div>
                
                <div class="exercise-container" id="round1-content">
                    <div class="word-list" id="word-list">
                        <!-- Words will be generated here -->
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div class="nav-buttons-group">
                            <button class="nav-btn skip" id="skip-round1">
                                <i class="fas fa-forward"></i> Skip Round
                            </button>
                            <button class="nav-btn next" id="next-round1">
                                Next Round <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Round 2: Fill in the blanks -->
                <div class="round-header" id="round2-header" style="display: none;">
                    <div class="round-header-info">
                        <h2><i class="fas fa-edit"></i> Round 2: Fill in the Blanks</h2>
                        <p>Drag and drop the correct words into the blanks to complete the sentences.</p>
                    </div>
                    <div class="round-stats">
                        <div class="round-stat-item">
                            <span class="round-stat-label">Completed:</span>
                            <span class="round-stat-value" id="round2-completed">0 times</span>
                        </div>
                        <div class="round-stat-item">
                            <span class="round-stat-label">XP Earned:</span>
                            <span class="round-stat-value xp-earned" id="round2-xp">0 XP</span>
                        </div>
                    </div>
                </div>
                
                <div class="exercise-container" id="round2-content" style="display: none;">
                    <div class="sentence-exercise" id="sentence-exercise">
                        <!-- Sentences with blanks will be generated here -->
                    </div>
                    <div class="word-options-container">
                        <h4><i class="fas fa-list"></i> Word Options:</h4>
                        <div class="word-options" id="word-options">
                            <!-- Word options will be generated here -->
                        </div>
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round2">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div class="nav-buttons-group">
                            <button class="nav-btn skip" id="skip-round2">
                                <i class="fas fa-forward"></i> Skip Round
                            </button>
                            <button class="nav-btn next" id="next-round2">
                                Next Round <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Round 3: Speak & Dictate -->
                <div class="round-header" id="round3-header" style="display: none;">
                    <div class="round-header-info">
                        <h2><i class="fas fa-microphone"></i> Round 3: Speak & Dictate</h2>
                        <p>Listen to each sentence with British English pronunciation and speak it aloud.</p>
                    </div>
                    <div class="round-stats">
                        <div class="round-stat-item">
                            <span class="round-stat-label">Completed:</span>
                            <span class="round-stat-value" id="round3-completed">0 times</span>
                        </div>
                        <div class="round-stat-item">
                            <span class="round-stat-label">XP Earned:</span>
                            <span class="round-stat-value xp-earned" id="round3-xp">0 XP</span>
                        </div>
                    </div>
                </div>
                
                <div class="exercise-container" id="round3-content" style="display: none;">
                    <div class="dictation-container">
                        <div class="sentence-progress" id="sentence-progress">
                            <span>Sentence 1 of 11</span>
                            <span id="sentence-score">Score: 0</span>
                        </div>
                        <div class="dictation-text" id="dictation-text">
                            We do not need to plan our trip if we go on a guided tour.
                        </div>
                        
                        <div class="sentence-controls">
                            <button class="sentence-control-btn" id="prev-sentence-btn">
                                <i class="fas fa-arrow-left"></i> Previous Sentence
                            </button>
                            <button class="sentence-control-btn" id="next-sentence-btn">
                                Next Sentence <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                        
                        <div class="voice-controls">
                            <button class="voice-btn" id="listen-btn">
                                <i class="fas fa-volume-up"></i> Listen to Sentence
                            </button>
                            <button class="voice-btn" id="speak-btn">
                                <i class="fas fa-microphone"></i> Start Speaking
                            </button>
                        </div>
                        <div class="result-message" id="result-message"></div>
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round3">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div class="nav-buttons-group">
                            <button class="nav-btn skip" id="skip-round3">
                                <i class="fas fa-forward"></i> Skip Round
                            </button>
                            <button class="nav-btn next" id="next-round3">
                                Next Round <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Round 4: Bonus Words -->
                <div class="round-header" id="round4-header" style="display: none;">
                    <div class="round-header-info">
                        <h2><i class="fas fa-star"></i> Round 4: Bonus Words</h2>
                        <p>Expand your vocabulary with these bonus words and example sentences.</p>
                    </div>
                    <div class="round-stats">
                        <div class="round-stat-item">
                            <span class="round-stat-label">Completed:</span>
                            <span class="round-stat-value" id="round4-completed">0 times</span>
                        </div>
                        <div class="round-stat-item">
                            <span class="round-stat-label">XP Earned:</span>
                            <span class="round-stat-value xp-earned" id="round4-xp">0 XP</span>
                        </div>
                    </div>
                </div>
                
                <div class="exercise-container" id="round4-content" style="display: none;">
                    <div class="bonus-words" id="bonus-words">
                        <!-- Bonus words will be generated here -->
                    </div>
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round4">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div class="nav-buttons-group">
                            <button class="nav-btn skip" id="skip-round4">
                                <i class="fas fa-forward"></i> Skip Round
                            </button>
                            <button class="nav-btn next" id="next-round4">
                                Next Round <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Round 5: Paragraph Dictation -->
                <div class="round-header" id="round5-header" style="display: none;">
                    <div class="round-header-info">
                        <h2><i class="fas fa-paragraph"></i> Round 5: Paragraph Dictation</h2>
                        <p>Listen to the paragraph and fill in the blanks with the correct words.</p>
                    </div>
                    <div class="round-stats">
                        <div class="round-stat-item">
                            <span class="round-stat-label">Completed:</span>
                            <span class="round-stat-value" id="round5-completed">0 times</span>
                        </div>
                        <div class="round-stat-item">
                            <span class="round-stat-label">XP Earned:</span>
                            <span class="round-stat-value xp-earned" id="round5-xp">0 XP</span>
                        </div>
                    </div>
                </div>
                
                <div class="exercise-container" id="round5-content" style="display: none;">
                    <div class="paragraph-container">
                        <div class="paragraph-text" id="paragraph-text">
                            <!-- Paragraph will be generated here -->
                        </div>
                        
                        <div class="voice-controls">
                            <button class="voice-btn" id="listen-paragraph-btn">
                                <i class="fas fa-volume-up"></i> Listen to Paragraph
                            </button>
                            <button class="voice-btn stop-btn" id="stop-paragraph-btn">
                                <i class="fas fa-stop"></i> Stop
                            </button>
                            <button class="voice-btn pause-btn" id="pause-paragraph-btn">
                                <i class="fas fa-pause"></i> Pause
                            </button>
                        </div>
                        
                        <div class="paragraph-dictation">
                            <h3><i class="fas fa-edit"></i> Fill in the blanks in the paragraph below:</h3>
                            <div id="paragraph-with-blanks">
                                <!-- Paragraph with blanks will be generated here -->
                            </div>
                            <div class="paragraph-options-container">
                                <h4><i class="fas fa-list"></i> Word Options:</h4>
                                <div class="paragraph-options" id="paragraph-options">
                                    <!-- Word options will be generated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="navigation">
                        <button class="nav-btn prev" id="prev-round5">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <div class="nav-buttons-group">
                            <button class="nav-btn skip" id="skip-round5">
                                <i class="fas fa-forward"></i> Skip Round
                            </button>
                            <button class="nav-btn" id="finish-btn">
                                Finish Lesson <i class="fas fa-trophy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="success-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon">
                    <i class="fas fa-check"></i>
                </div>
                <div class="modal-title">Great Job!</div>
            </div>
            <div class="modal-content" id="modal-content">
                All sentences are completed correctly!
            </div>
            <div class="modal-stats" id="modal-stats">
                <!-- Stats will be inserted here -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn" id="modal-ok-btn">Continue</button>
            </div>
        </div>
    </div>

    <!-- Skip Confirmation Modal -->
    <div class="modal-overlay" id="skip-modal">
        <div class="modal skip-confirmation">
            <div class="modal-header">
                <div class="modal-icon" style="background-color: var(--skip-color);">
                    <i class="fas fa-forward"></i>
                </div>
                <div class="modal-title">Skip Round?</div>
            </div>
            <div class="modal-content">
                <div class="skip-warning">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <strong>Warning:</strong> Skipping this round will give you reduced XP.
                </div>
                <p>Are you sure you want to skip this round? You will still be able to come back and complete it later.</p>
                <div class="modal-stats">
                    <div class="modal-stat">
                        <span class="modal-stat-label">Full XP:</span>
                        <span class="modal-stat-value" id="full-xp-value">100 XP</span>
                    </div>
                    <div class="modal-stat">
                        <span class="modal-stat-label">Skipped XP:</span>
                        <span class="modal-stat-value" id="skipped-xp-value">25 XP</span>
                    </div>
                    <div class="modal-stat">
                        <span class="modal-stat-label">XP Lost:</span>
                        <span class="modal-stat-value" style="color: #F44336;">-75 XP</span>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="skip-cancel-btn">Cancel</button>
                <button class="modal-btn" id="skip-confirm-btn" style="background-color: var(--skip-color);">Skip Round</button>
            </div>
        </div>
    </div>

    <script>
        // Application data - Updated with ALL new words from all images
        const appData = {
            currentRound: 1,
            points: 0,
            totalXP: 0,
            level: 1,
            currentSentenceIndex: 0,
            round2Score: 0,
            round3Score: 0,
            // Round completion tracking
            roundCompletions: {
                1: { completed: 0, xpEarned: 0, skipped: false },
                2: { completed: 0, xpEarned: 0, skipped: false },
                3: { completed: 0, xpEarned: 0, skipped: false },
                4: { completed: 0, xpEarned: 0, skipped: false },
                5: { completed: 0, xpEarned: 0, skipped: false }
            },
            // XP values for each round
            roundXP: {
                1: { full: 100, skipped: 25 },
                2: { full: 150, skipped: 40 },
                3: { full: 200, skipped: 50 },
                4: { full: 100, skipped: 25 },
                5: { full: 250, skipped: 60 }
            },
            // All words from all images (11 words total)
            words: [
                { word: "go on a guided tour", meaning: "We do not need to plan our trip if we go on a guided tour." },
                { word: "ride on a banana boat", meaning: "I like water sports. I want to ride on a banana boat in Thailand." },
                { word: "visit a zoo", meaning: "Kelly visited a zoo last summer. She saw many different animals." },
                { word: "visit a palace", meaning: "I want to visit a palace in England. The kings used to live there." },
                { word: "go sightseeing", meaning: "We go sightseeing when we travel in different countries." },
                { word: "go snowboarding", meaning: "Ken wants to go snowboarding. He thinks it is challenging." },
                { word: "go on a cruise", meaning: "Tourists like going on a cruise. They think it is relaxing." },
                { word: "visit a theme park", meaning: "Tourists like visiting theme parks such as Hong Kong Disneyland." },
                { word: "feed a kangaroo", meaning: "We can feed a kangaroo in Australia." },
                { word: "go skiing", meaning: "Alan went skiing in winter last year." },
                { word: "go into a rainforest", meaning: "Let's go into a rainforest and look at special plants there." }
            ],
            // Sentences for fill in the blanks (Round 2)
            sentences: [
                "We do not need to plan our trip if we __________.",
                "I like water sports. I want to __________ in Thailand.",
                "Kelly __________ last summer. She saw many different animals.",
                "I want to __________ in England. The kings used to live there.",
                "We __________ when we travel in different countries.",
                "Ken wants to __________. He thinks it is challenging.",
                "Tourists like __________. They think it is relaxing.",
                "Tourists like __________ such as Hong Kong Disneyland.",
                "We can __________ in Australia.",
                "Alan __________ in winter last year.",
                "Let's __________ and look at special plants there."
            ],
            // Sentences for dictation (Round 3) - All 11 sentences
            dictationSentences: [
                "We do not need to plan our trip if we go on a guided tour.",
                "I like water sports. I want to ride on a banana boat in Thailand.",
                "Kelly visited a zoo last summer. She saw many different animals.",
                "I want to visit a palace in England. The kings used to live there.",
                "We go sightseeing when we travel in different countries.",
                "Ken wants to go snowboarding. He thinks it is challenging.",
                "Tourists like going on a cruise. They think it is relaxing.",
                "Tourists like visiting theme parks such as Hong Kong Disneyland.",
                "We can feed a kangaroo in Australia.",
                "Alan went skiing in winter last year.",
                "Let's go into a rainforest and look at special plants there."
            ],
            // Bonus words for Round 4 - Expanded to 20 words
            bonusWords: [
                { word: "go hiking", sentence: "On weekends, we like to go hiking in the mountains near our city." },
                { word: "try local food", sentence: "When traveling, it's important to try local food to experience the culture." },
                { word: "take photos", sentence: "Tourists often take photos of famous landmarks to remember their trips." },
                { word: "buy souvenirs", sentence: "We always buy souvenirs for our friends and family when we travel." },
                { word: "rent a car", sentence: "It's convenient to rent a car when you want to explore remote areas." },
                { word: "book a hotel", sentence: "You should book a hotel in advance during the peak travel season." },
                { word: "visit museums", sentence: "When in a new city, I love to visit museums to learn about its history." },
                { word: "go camping", sentence: "In summer, many families go camping in national parks." },
                { word: "attend a festival", sentence: "We plan to attend a festival to experience traditional celebrations." },
                { word: "learn the language", sentence: "Before traveling to a new country, I try to learn the language basics." },
                { word: "use public transport", sentence: "In big cities, it's often easier to use public transport than drive." },
                { word: "pack luggage", sentence: "I need to pack luggage for our two-week vacation to Europe." },
                { word: "check the weather", sentence: "Before going out, we should check the weather forecast." },
                { word: "exchange currency", sentence: "Don't forget to exchange currency before traveling abroad." },
                { word: "apply for a visa", sentence: "Some countries require tourists to apply for a visa in advance." },
                { word: "get travel insurance", sentence: "It's wise to get travel insurance in case of emergencies." },
                { word: "follow a map", sentence: "When exploring a new city, we follow a map to find our way." },
                { word: "ask for directions", sentence: "If you get lost, don't hesitate to ask for directions." },
                { word: "make reservations", sentence: "For popular restaurants, it's best to make reservations ahead of time." },
                { word: "share experiences", sentence: "After our trip, we like to share experiences with our friends." }
            ],
            // Paragraph for Round 5
            paragraph: {
                title: "A Delightful Dinner",
                text: "I was thrilled to experience Thai cuisine in Mong Kok with my friends last night. We decided to order a variety of dishes to share together. Mark chose the spicy green curry, while Sally opted for the tasty spring rolls. As for me, I couldn't resist ordering my favorite Tom Yum Goong soup and a delightful slice of mango sticky rice. We had a fantastic meal together.",
                wordCount: 70,
                blanks: [
                    { word: "thrilled", hint: "very excited" },
                    { word: "cuisine", hint: "style of cooking" },
                    { word: "variety", hint: "different types" },
                    { word: "spicy", hint: "hot flavor" },
                    { word: "tasty", hint: "delicious" },
                    { word: "delightful", hint: "very pleasant" },
                    { word: "fantastic", hint: "excellent" }
                ]
            }
        };
        
        // DOM elements
        const pointsElement = document.getElementById('points');
        const totalXPElement = document.getElementById('total-xp');
        const levelElement = document.getElementById('level');
        const roundItems = document.querySelectorAll('.round-item');
        const roundHeaders = document.querySelectorAll('.round-header');
        const roundContents = document.querySelectorAll('.exercise-container');
        const voiceSelect = document.getElementById('voice-select');
        const successModal = document.getElementById('success-modal');
        const skipModal = document.getElementById('skip-modal');
        const modalContent = document.getElementById('modal-content');
        const modalStats = document.getElementById('modal-stats');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        const skipCancelBtn = document.getElementById('skip-cancel-btn');
        const skipConfirmBtn = document.getElementById('skip-confirm-btn');
        const fullXPValue = document.getElementById('full-xp-value');
        const skippedXPValue = document.getElementById('skipped-xp-value');
        
        // Variables for speech synthesis
        let voices = [];
        let britishVoice = null;
        let selectedVoice = null;
        let currentUtterance = null;
        let isPaused = false;
        let speechRecognition = null;
        
        // Variables for skip functionality
        let roundToSkip = null;
        
        // Initialize the app
        function initApp() {
            loadProgressFromStorage();
            updateStats();
            loadRound1();
            updateRoundStatsDisplay();
            setupEventListeners();
            
            // Load voices when they become available
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
            
            // Load voices immediately if they're already available
            if (speechSynthesis.getVoices().length > 0) {
                loadVoices();
            }
        }
        
        // Load progress from localStorage
        function loadProgressFromStorage() {
            const savedData = localStorage.getItem('dictationProgress');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                appData.points = parsedData.points || 0;
                appData.totalXP = parsedData.totalXP || 0;
                appData.level = parsedData.level || 1;
                appData.roundCompletions = parsedData.roundCompletions || appData.roundCompletions;
            }
        }
        
        // Save progress to localStorage
        function saveProgressToStorage() {
            const dataToSave = {
                points: appData.points,
                totalXP: appData.totalXP,
                level: appData.level,
                roundCompletions: appData.roundCompletions
            };
            localStorage.setItem('dictationProgress', JSON.stringify(dataToSave));
        }
        
        // Load available voices
        function loadVoices() {
            // Get available voices
            voices = speechSynthesis.getVoices();
            
            // Clear voice select
            voiceSelect.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a voice...';
            voiceSelect.appendChild(defaultOption);
            
            // Filter for British English voices
            const britishVoices = voices.filter(voice => 
                voice.lang.startsWith('en-GB') || 
                voice.name.toLowerCase().includes('british') ||
                voice.name.toLowerCase().includes('uk')
            );
            
            // Add British voices first
            if (britishVoices.length > 0) {
                const britishGroup = document.createElement('optgroup');
                britishGroup.label = 'British English Voices';
                
                britishVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    britishGroup.appendChild(option);
                    
                    // Set as default British voice
                    if (!britishVoice && voice.lang.startsWith('en-GB')) {
                        britishVoice = voice;
                        option.selected = true;
                        selectedVoice = voice;
                    }
                });
                
                voiceSelect.appendChild(britishGroup);
            }
            
            // Add other English voices
            const otherEnglishVoices = voices.filter(voice => 
                voice.lang.startsWith('en-') && 
                !voice.lang.startsWith('en-GB') &&
                !britishVoices.includes(voice)
            );
            
            if (otherEnglishVoices.length > 0) {
                const otherGroup = document.createElement('optgroup');
                otherGroup.label = 'Other English Voices';
                
                otherEnglishVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    otherGroup.appendChild(option);
                });
                
                voiceSelect.appendChild(otherGroup);
            }
            
            // If no voices found
            if (voices.length === 0) {
                const noVoiceOption = document.createElement('option');
                noVoiceOption.value = '';
                noVoiceOption.textContent = 'No voices available';
                voiceSelect.appendChild(noVoiceOption);
            }
            
            // Add event listener for voice selection
            voiceSelect.addEventListener('change', function() {
                const voiceName = this.value;
                selectedVoice = voices.find(voice => voice.name === voiceName);
            });
        }
        
        // Update user stats
        function updateStats() {
            pointsElement.textContent = appData.points;
            totalXPElement.textContent = appData.totalXP;
            levelElement.textContent = appData.level;
        }
        
        // Update round stats display
        function updateRoundStatsDisplay() {
            for (let round = 1; round <= 5; round++) {
                const completionData = appData.roundCompletions[round];
                const completedElement = document.getElementById(`round${round}-completed`);
                const xpElement = document.getElementById(`round${round}-xp`);
                
                if (completedElement) {
                    completedElement.textContent = `${completionData.completed} time${completionData.completed !== 1 ? 's' : ''}`;
                }
                
                if (xpElement) {
                    xpElement.textContent = `${completionData.xpEarned} XP`;
                }
                
                // Update round item in sidebar
                const roundItem = document.querySelector(`.round-item[data-round="${round}"]`);
                if (roundItem) {
                    // Remove existing badges
                    const existingBadge = roundItem.querySelector('.completion-badge');
                    if (existingBadge) {
                        existingBadge.remove();
                    }
                    
                    // Update classes
                    roundItem.classList.remove('completed', 'skipped');
                    
                    if (completionData.completed > 0) {
                        roundItem.classList.add('completed');
                        // Add completion badge
                        const badge = document.createElement('div');
                        badge.className = 'completion-badge';
                        badge.textContent = completionData.completed;
                        roundItem.appendChild(badge);
                    } else if (completionData.skipped) {
                        roundItem.classList.add('skipped');
                    }
                }
            }
        }
        
        // Load Round 1: New Words
        function loadRound1() {
            const wordList = document.getElementById('word-list');
            wordList.innerHTML = '';
            
            // Show ALL 11 words
            appData.words.forEach((wordObj, index) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                wordItem.innerHTML = `
                    <div class="word-text">${wordObj.word}</div>
                    <div class="word-meaning">"${wordObj.meaning}"</div>
                    <div class="word-buttons">
                        <button class="speak-btn" data-word="${wordObj.word}">
                            <i class="fas fa-volume-up"></i> Speak Word
                        </button>
                        <button class="speak-btn sentence-btn" data-sentence="${wordObj.meaning}">
                            <i class="fas fa-comment-alt"></i> Speak Sentence
                        </button>
                    </div>
                `;
                wordList.appendChild(wordItem);
            });
            
            // Add event listeners to speak buttons
            document.querySelectorAll('.speak-btn[data-word]').forEach(button => {
                button.addEventListener('click', function() {
                    const word = this.getAttribute('data-word');
                    speakWord(word);
                    // Add points for interaction
                    addPoints(5);
                });
            });
            
            // Add event listeners to speak sentence buttons
            document.querySelectorAll('.speak-btn[data-sentence]').forEach(button => {
                button.addEventListener('click', function() {
                    const sentence = this.getAttribute('data-sentence');
                    speakWord(sentence);
                    // Add points for interaction
                    addPoints(5);
                });
            });
        }
        
        // Load Round 2: Fill in the blanks - FIXED: Now with random order options
        function loadRound2() {
            const sentenceExercise = document.getElementById('sentence-exercise');
            const wordOptions = document.getElementById('word-options');
            
            sentenceExercise.innerHTML = '';
            wordOptions.innerHTML = '';
            
            // Create pairs of words and sentences (using all 11 words)
            let pairs = [];
            for (let i = 0; i < appData.words.length; i++) {
                pairs.push({
                    word: appData.words[i].word,
                    sentence: appData.sentences[i]
                });
            }
            
            // Shuffle pairs for this round - Sentences will be in random order
            pairs = shuffleArray([...pairs]);
            
            // Create sentences with blanks
            pairs.forEach((pair, index) => {
                const sentence = pair.sentence;
                const word = pair.word;
                const blankId = `blank-${index}`;
                
                const sentenceElement = document.createElement('div');
                sentenceElement.className = 'sentence';
                sentenceElement.innerHTML = `${index + 1}. ${sentence.replace('__________', `<span class="blank" id="${blankId}" data-answer="${word}">__________</span>`)}`;
                sentenceExercise.appendChild(sentenceElement);
            });
            
            // Extract words from pairs for options
            let options = pairs.map(pair => pair.word);
            
            // FIXED: Shuffle options - Words will be in random order
            options = shuffleArray([...options]);
            
            // Create word options
            options.forEach((word, index) => {
                const wordOption = document.createElement('div');
                wordOption.className = 'word-option';
                wordOption.textContent = word;
                wordOption.setAttribute('data-word', word);
                wordOptions.appendChild(wordOption);
            });
            
            // Add event listeners to word options
            document.querySelectorAll('.word-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('used')) return;
                    
                    const word = this.getAttribute('data-word');
                    const blank = document.querySelector(`.blank[data-answer="${word}"]`);
                    
                    if (blank && !blank.classList.contains('has-answer')) {
                        blank.textContent = word;
                        blank.classList.add('has-answer');
                        this.classList.add('used');
                        
                        // Add points
                        addPoints(10);
                        appData.round2Score += 10;
                        
                        // Check if all blanks are filled
                        checkAllBlanksFilled();
                    }
                });
            });
        }
        
        // Check if all blanks are filled - FIXED: Now shows modal instead of alert
        function checkAllBlanksFilled() {
            const blanks = document.querySelectorAll('.blank');
            const allFilled = Array.from(blanks).every(blank => blank.classList.contains('has-answer'));
            
            if (allFilled) {
                // Mark round as completed
                markRoundAsCompleted(2, appData.round2Score);
                
                // Show success message using modal
                setTimeout(() => {
                    modalContent.textContent = `Great job! All sentences are completed correctly! You earned ${appData.round2Score} points!`;
                    
                    // Add stats to modal
                    modalStats.innerHTML = `
                        <div class="modal-stat">
                            <span class="modal-stat-label">Round Score:</span>
                            <span class="modal-stat-value">${appData.round2Score} points</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">Round XP:</span>
                            <span class="modal-stat-value" style="color: var(--xp-color);">${appData.roundXP[2].full} XP</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">Total Completions:</span>
                            <span class="modal-stat-value">${appData.roundCompletions[2].completed}</span>
                        </div>
                    `;
                    
                    successModal.classList.add('active');
                    
                    // Add bonus points for completing the round
                    addPoints(25);
                }, 500);
            }
        }
        
        // Load Round 3: Speak & Dictate
        function loadRound3() {
            const dictationText = document.getElementById('dictation-text');
            const sentenceProgress = document.getElementById('sentence-progress');
            const prevSentenceBtn = document.getElementById('prev-sentence-btn');
            const nextSentenceBtn = document.getElementById('next-sentence-btn');
            const sentenceScore = document.getElementById('sentence-score');
            
            // Load current sentence
            const sentenceIndex = appData.currentSentenceIndex;
            const sentence = appData.dictationSentences[sentenceIndex];
            dictationText.textContent = sentence;
            dictationText.setAttribute('data-sentence', sentence);
            
            // Update progress
            sentenceProgress.innerHTML = `<span>Sentence ${sentenceIndex + 1} of ${appData.dictationSentences.length}</span><span id="sentence-score">Score: ${appData.round3Score}</span>`;
            
            // Update button states
            prevSentenceBtn.disabled = (sentenceIndex === 0);
            nextSentenceBtn.disabled = (sentenceIndex === appData.dictationSentences.length - 1);
            
            // Reset result message
            const resultMessage = document.getElementById('result-message');
            resultMessage.className = 'result-message';
            resultMessage.textContent = '';
            resultMessage.style.display = 'none';
            
            // Setup speech recognition for current sentence
            setupSpeechRecognition();
        }
        
        // Load Round 4: Bonus Words
        function loadRound4() {
            const bonusWordsContainer = document.getElementById('bonus-words');
            bonusWordsContainer.innerHTML = '';
            
            // Shuffle bonus words for variety
            const shuffledBonusWords = shuffleArray([...appData.bonusWords]);
            
            // Show bonus words (20 words)
            shuffledBonusWords.forEach(bonusWord => {
                const bonusCard = document.createElement('div');
                bonusCard.className = 'bonus-card';
                bonusCard.innerHTML = `
                    <h4><i class="fas fa-star"></i> ${bonusWord.word}</h4>
                    <div class="bonus-sentence">"${bonusWord.sentence}"</div>
                    <div class="word-buttons">
                        <button class="speak-btn" data-word="${bonusWord.word}">
                            <i class="fas fa-volume-up"></i> Speak Word
                        </button>
                        <button class="speak-btn sentence-btn" data-sentence="${bonusWord.sentence}">
                            <i class="fas fa-comment-alt"></i> Speak Sentence
                        </button>
                    </div>
                `;
                bonusWordsContainer.appendChild(bonusCard);
            });
            
            // Add event listeners to speak buttons
            document.querySelectorAll('.bonus-card .speak-btn[data-word]').forEach(button => {
                button.addEventListener('click', function() {
                    const word = this.getAttribute('data-word');
                    speakWord(word);
                    addPoints(5);
                });
            });
            
            // Add event listeners to speak sentence buttons
            document.querySelectorAll('.bonus-card .speak-btn[data-sentence]').forEach(button => {
                button.addEventListener('click', function() {
                    const sentence = this.getAttribute('data-sentence');
                    speakWord(sentence);
                    addPoints(5);
                });
            });
        }
        
        // Load Round 5: Paragraph Dictation
        function loadRound5() {
            const paragraphText = document.getElementById('paragraph-text');
            const paragraphWithBlanks = document.getElementById('paragraph-with-blanks');
            const paragraphOptions = document.getElementById('paragraph-options');
            
            // Display the full paragraph
            paragraphText.innerHTML = `
                <h3>${appData.paragraph.title}</h3>
                <p>${appData.paragraph.text}</p>
                <p style="margin-top: 10px; font-size: 14px; color: #666;"><i class="fas fa-info-circle"></i> ${appData.paragraph.wordCount} words</p>
            `;
            
            // Create paragraph with blanks
            let paragraphWithBlanksText = appData.paragraph.text;
            paragraphOptions.innerHTML = '';
            
            // Create word options from the blanks
            const blankWords = [];
            
            appData.paragraph.blanks.forEach((blank, index) => {
                // Replace the word with a blank
                const regex = new RegExp(`\\b${blank.word}\\b`, 'i');
                paragraphWithBlanksText = paragraphWithBlanksText.replace(regex, `<span class="paragraph-blank" id="paragraph-blank-${index}" data-answer="${blank.word}">__________</span>`);
                
                // Add to word options
                blankWords.push({
                    word: blank.word,
                    hint: blank.hint
                });
            });
            
            // Display paragraph with blanks
            paragraphWithBlanks.innerHTML = `<p>${paragraphWithBlanksText}</p>`;
            
            // Shuffle word options - Words will be in random order
            const shuffledWords = shuffleArray([...blankWords]);
            
            // Create word options
            shuffledWords.forEach((wordObj, index) => {
                const wordOption = document.createElement('div');
                wordOption.className = 'paragraph-option';
                wordOption.innerHTML = `
                    <div>${wordObj.word}</div>
                    <div style="font-size: 12px; font-weight: normal; color: #666;">(${wordObj.hint})</div>
                `;
                wordOption.setAttribute('data-word', wordObj.word);
                paragraphOptions.appendChild(wordOption);
            });
            
            // Add event listeners to word options
            document.querySelectorAll('.paragraph-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.classList.contains('used')) return;
                    
                    const word = this.getAttribute('data-word');
                    const blank = document.querySelector(`.paragraph-blank[data-answer="${word}"]`);
                    
                    if (blank && !blank.classList.contains('has-answer')) {
                        blank.textContent = word;
                        blank.classList.add('has-answer');
                        this.classList.add('used');
                        
                        // Check if all blanks are filled
                        checkParagraphBlanksFilled();
                        addPoints(15);
                    }
                });
            });
        }
        
        // Check if all paragraph blanks are filled
        function checkParagraphBlanksFilled() {
            const blanks = document.querySelectorAll('.paragraph-blank');
            const allFilled = Array.from(blanks).every(blank => blank.classList.contains('has-answer'));
            
            if (allFilled) {
                // Mark round as completed
                markRoundAsCompleted(5, 100);
                
                // Show success message
                setTimeout(() => {
                    modalContent.textContent = 'Excellent! You have completed the paragraph dictation!';
                    
                    // Add stats to modal
                    modalStats.innerHTML = `
                        <div class="modal-stat">
                            <span class="modal-stat-label">Round Score:</span>
                            <span class="modal-stat-value">100 points</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">Round XP:</span>
                            <span class="modal-stat-value" style="color: var(--xp-color);">${appData.roundXP[5].full} XP</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">Total Completions:</span>
                            <span class="modal-stat-value">${appData.roundCompletions[5].completed}</span>
                        </div>
                    `;
                    
                    successModal.classList.add('active');
                    addPoints(50);
                }, 500);
            }
        }
        
        // Mark a round as completed
        function markRoundAsCompleted(roundNumber, points) {
            const completionData = appData.roundCompletions[roundNumber];
            
            // Increment completion count
            completionData.completed++;
            
            // Calculate XP earned (full XP for completion)
            const xpEarned = appData.roundXP[roundNumber].full;
            completionData.xpEarned += xpEarned;
            
            // Add XP to total
            appData.totalXP += xpEarned;
            
            // Reset skipped flag if previously skipped
            if (completionData.skipped) {
                completionData.skipped = false;
            }
            
            // Update display
            updateRoundStatsDisplay();
            updateStats();
            
            // Save to storage
            saveProgressToStorage();
            
            // Check for level up
            checkLevelUp();
        }
        
        // Mark a round as skipped
        function markRoundAsSkipped(roundNumber) {
            const completionData = appData.roundCompletions[roundNumber];
            
            // Mark as skipped
            completionData.skipped = true;
            
            // Calculate reduced XP earned
            const xpEarned = appData.roundXP[roundNumber].skipped;
            completionData.xpEarned += xpEarned;
            
            // Add XP to total
            appData.totalXP += xpEarned;
            
            // Update display
            updateRoundStatsDisplay();
            updateStats();
            
            // Save to storage
            saveProgressToStorage();
            
            // Check for level up
            checkLevelUp();
        }
        
        // Check for level up
        function checkLevelUp() {
            const xpNeededForNextLevel = appData.level * 100;
            
            if (appData.totalXP >= xpNeededForNextLevel) {
                appData.level++;
                levelElement.textContent = appData.level;
                
                // Animate level
                levelElement.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    levelElement.style.transform = 'scale(1)';
                }, 300);
                
                // Show level up message
                setTimeout(() => {
                    modalContent.textContent = `Congratulations! You've reached level ${appData.level}!`;
                    modalStats.innerHTML = `
                        <div class="modal-stat">
                            <span class="modal-stat-label">Total XP:</span>
                            <span class="modal-stat-value" style="color: var(--xp-color);">${appData.totalXP} XP</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">New Level:</span>
                            <span class="modal-stat-value">${appData.level}</span>
                        </div>
                    `;
                    successModal.classList.add('active');
                }, 500);
            }
        }
        
        // Show skip confirmation modal
        function showSkipConfirmation(roundNumber) {
            roundToSkip = roundNumber;
            
            // Update XP values in modal
            const fullXP = appData.roundXP[roundNumber].full;
            const skippedXP = appData.roundXP[roundNumber].skipped;
            const xpLost = fullXP - skippedXP;
            
            fullXPValue.textContent = `${fullXP} XP`;
            skippedXPValue.textContent = `${skippedXP} XP`;
            
            // Show modal
            skipModal.classList.add('active');
        }
        
        // Skip the current round
        function skipCurrentRound() {
            if (!roundToSkip) return;
            
            // Mark round as skipped
            markRoundAsSkipped(roundToSkip);
            
            // Move to next round
            if (roundToSkip < 5) {
                changeRound(roundToSkip + 1);
            } else {
                // If skipping last round, go back to first
                changeRound(1);
            }
            
            // Close modal
            skipModal.classList.remove('active');
            roundToSkip = null;
        }
        
        // Shuffle array function (Fisher-Yates algorithm)
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Speak a word using Web Speech API with British English accent
        function speakWord(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to use British English voice if available
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                } else if (britishVoice) {
                    utterance.voice = britishVoice;
                } else {
                    // Fallback to any English voice
                    const englishVoices = voices.filter(voice => voice.lang.startsWith('en-'));
                    if (englishVoices.length > 0) {
                        utterance.voice = englishVoices[0];
                    }
                }
                
                // Set British English pronunciation
                utterance.lang = 'en-GB';
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                // Store current utterance for pause/stop control
                currentUtterance = utterance;
                
                speechSynthesis.speak(utterance);
                
                // Reset pause state
                isPaused = false;
            } else {
                alert("Your browser doesn't support speech synthesis. Try Chrome or Edge.");
            }
        }
        
        // Stop speech
        function stopSpeech() {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                isPaused = false;
                document.getElementById('pause-paragraph-btn').innerHTML = '<i class="fas fa-pause"></i> Pause';
            }
        }
        
        // Pause or resume speech
        function togglePauseSpeech() {
            if (!currentUtterance) return;
            
            if (isPaused) {
                speechSynthesis.resume();
                isPaused = false;
                document.getElementById('pause-paragraph-btn').innerHTML = '<i class="fas fa-pause"></i> Pause';
            } else {
                speechSynthesis.pause();
                isPaused = true;
                document.getElementById('pause-paragraph-btn').innerHTML = '<i class="fas fa-play"></i> Resume';
            }
        }
        
        // Speak a sentence
        function speakSentence() {
            const dictationText = document.getElementById('dictation-text');
            const sentence = dictationText.getAttribute('data-sentence');
            speakWord(sentence);
        }
        
        // Speak the paragraph
        function speakParagraph() {
            speakWord(appData.paragraph.text);
        }
        
        // Setup speech recognition for Round 3
        function setupSpeechRecognition() {
            const speakBtn = document.getElementById('speak-btn');
            const resultMessage = document.getElementById('result-message');
            const dictationText = document.getElementById('dictation-text');
            const targetSentence = dictationText.getAttribute('data-sentence').toLowerCase();
            
            // Check if browser supports speech recognition
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                speakBtn.disabled = true;
                speakBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Speech Not Supported';
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            // If recognition already exists, stop it
            if (speechRecognition) {
                speechRecognition.stop();
            }
            
            speechRecognition = new SpeechRecognition();
            
            speechRecognition.lang = 'en-GB'; // Use British English for recognition
            speechRecognition.interimResults = false;
            speechRecognition.maxAlternatives = 1;
            
            speakBtn.addEventListener('click', function() {
                if (speakBtn.classList.contains('recording')) {
                    speechRecognition.stop();
                    speakBtn.classList.remove('recording');
                    speakBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Speaking';
                    return;
                }
                
                speakBtn.classList.add('recording');
                speakBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Stop Recording';
                resultMessage.style.display = 'none';
                
                speechRecognition.start();
            });
            
            speechRecognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase();
                speakBtn.classList.remove('recording');
                speakBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Speaking';
                
                // Simple comparison (in a real app, you'd want more sophisticated matching)
                const similarity = calculateSimilarity(transcript, targetSentence);
                
                if (similarity > 0.7) {
                    resultMessage.textContent = `Excellent! You said: "${transcript}"`;
                    resultMessage.className = 'result-message correct';
                    resultMessage.style.display = 'block';
                    addPoints(30);
                    appData.round3Score += 30;
                    
                    // Check if all sentences are completed
                    if (appData.currentSentenceIndex === appData.dictationSentences.length - 1) {
                        // Mark round as completed
                        markRoundAsCompleted(3, appData.round3Score);
                        
                        // Show completion modal
                        setTimeout(() => {
                            modalContent.textContent = `Congratulations! You completed all dictation sentences!`;
                            modalStats.innerHTML = `
                                <div class="modal-stat">
                                    <span class="modal-stat-label">Round Score:</span>
                                    <span class="modal-stat-value">${appData.round3Score} points</span>
                                </div>
                                <div class="modal-stat">
                                    <span class="modal-stat-label">Round XP:</span>
                                    <span class="modal-stat-value" style="color: var(--xp-color);">${appData.roundXP[3].full} XP</span>
                                </div>
                                <div class="modal-stat">
                                    <span class="modal-stat-label">Total Completions:</span>
                                    <span class="modal-stat-value">${appData.roundCompletions[3].completed}</span>
                                </div>
                            `;
                            successModal.classList.add('active');
                        }, 1000);
                    }
                    
                    checkLevelUp();
                } else {
                    resultMessage.textContent = `Good try! You said: "${transcript}". The correct sentence is: "${targetSentence}"`;
                    resultMessage.className = 'result-message incorrect';
                    resultMessage.style.display = 'block';
                    addPoints(10);
                    appData.round3Score += 10;
                }
                
                // Update score display
                document.getElementById('sentence-score').textContent = `Score: ${appData.round3Score}`;
            };
            
            speechRecognition.onerror = function(event) {
                speakBtn.classList.remove('recording');
                speakBtn.innerHTML = '<i class="fas fa-microphone"></i> Start Speaking';
                resultMessage.textContent = 'Error occurred in recognition: ' + event.error;
                resultMessage.className = 'result-message incorrect';
                resultMessage.style.display = 'block';
            };
        }
        
        // Simple similarity calculation (for demo purposes)
        function calculateSimilarity(str1, str2) {
            const words1 = str1.split(' ');
            const words2 = str2.split(' ');
            
            const commonWords = words1.filter(word => words2.includes(word)).length;
            const maxWords = Math.max(words1.length, words2.length);
            
            return commonWords / maxWords;
        }
        
        // Add points to user
        function addPoints(points) {
            appData.points += points;
            pointsElement.textContent = appData.points;
            
            // Animate points
            pointsElement.style.transform = 'scale(1.2)';
            setTimeout(() => {
                pointsElement.style.transform = 'scale(1)';
            }, 300);
            
            // Save to storage
            saveProgressToStorage();
        }
        
        // Change round
        function changeRound(roundNumber) {
            // Update current round
            appData.currentRound = roundNumber;
            
            // Update round progress UI
            roundItems.forEach(item => {
                item.classList.remove('active');
                const itemRound = parseInt(item.getAttribute('data-round'));
                
                if (itemRound < roundNumber) {
                    item.classList.add('completed');
                } else if (itemRound === roundNumber) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('completed');
                }
            });
            
            // Show/hide round content
            roundHeaders.forEach(header => {
                header.style.display = 'none';
            });
            
            roundContents.forEach(content => {
                content.style.display = 'none';
            });
            
            document.getElementById(`round${roundNumber}-header`).style.display = 'flex';
            document.getElementById(`round${roundNumber}-content`).style.display = 'block';
            
            // Load round-specific content
            switch(roundNumber) {
                case 1:
                    loadRound1();
                    break;
                case 2:
                    appData.round2Score = 0;
                    loadRound2();
                    break;
                case 3:
                    appData.currentSentenceIndex = 0; // Reset to first sentence
                    appData.round3Score = 0;
                    loadRound3();
                    break;
                case 4:
                    loadRound4();
                    break;
                case 5:
                    loadRound5();
                    break;
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Round navigation in sidebar
            roundItems.forEach(item => {
                item.addEventListener('click', function() {
                    const roundNumber = parseInt(this.getAttribute('data-round'));
                    if (roundNumber <= appData.currentRound || roundNumber === appData.currentRound + 1) {
                        changeRound(roundNumber);
                    }
                });
            });
            
            // Next/Previous buttons
            document.getElementById('next-round1').addEventListener('click', () => changeRound(2));
            document.getElementById('prev-round2').addEventListener('click', () => changeRound(1));
            document.getElementById('next-round2').addEventListener('click', () => changeRound(3));
            document.getElementById('prev-round3').addEventListener('click', () => changeRound(2));
            document.getElementById('next-round3').addEventListener('click', () => changeRound(4));
            document.getElementById('prev-round4').addEventListener('click', () => changeRound(3));
            document.getElementById('next-round4').addEventListener('click', () => changeRound(5));
            document.getElementById('prev-round5').addEventListener('click', () => changeRound(4));
            
            // Skip buttons
            document.getElementById('skip-round1').addEventListener('click', () => showSkipConfirmation(1));
            document.getElementById('skip-round2').addEventListener('click', () => showSkipConfirmation(2));
            document.getElementById('skip-round3').addEventListener('click', () => showSkipConfirmation(3));
            document.getElementById('skip-round4').addEventListener('click', () => showSkipConfirmation(4));
            document.getElementById('skip-round5').addEventListener('click', () => showSkipConfirmation(5));
            
            // Skip modal buttons
            skipCancelBtn.addEventListener('click', function() {
                skipModal.classList.remove('active');
                roundToSkip = null;
            });
            
            skipConfirmBtn.addEventListener('click', skipCurrentRound);
            
            // Finish button
            document.getElementById('finish-btn').addEventListener('click', function() {
                addPoints(50);
                
                // Check if all rounds are completed or skipped
                let allRoundsCompleted = true;
                for (let round = 1; round <= 5; round++) {
                    if (appData.roundCompletions[round].completed === 0 && !appData.roundCompletions[round].skipped) {
                        allRoundsCompleted = false;
                        break;
                    }
                }
                
                if (allRoundsCompleted) {
                    // Add bonus XP for completing all rounds
                    const bonusXP = 500;
                    appData.totalXP += bonusXP;
                    updateStats();
                    
                    modalContent.textContent = 'Outstanding! You have completed the entire lesson! You earned 50 bonus points and 500 bonus XP!';
                    modalStats.innerHTML = `
                        <div class="modal-stat">
                            <span class="modal-stat-label">Total Points:</span>
                            <span class="modal-stat-value">${appData.points} points</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">Total XP:</span>
                            <span class="modal-stat-value" style="color: var(--xp-color);">${appData.totalXP} XP</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">Current Level:</span>
                            <span class="modal-stat-value">${appData.level}</span>
                        </div>
                    `;
                } else {
                    modalContent.textContent = 'Congratulations! You have completed the lesson. You earned 50 bonus points!';
                    modalStats.innerHTML = `
                        <div class="modal-stat">
                            <span class="modal-stat-label">Total Points:</span>
                            <span class="modal-stat-value">${appData.points} points</span>
                        </div>
                        <div class="modal-stat">
                            <span class="modal-stat-label">Total XP:</span>
                            <span class="modal-stat-value" style="color: var(--xp-color);">${appData.totalXP} XP</span>
                        </div>
                    `;
                }
                
                successModal.classList.add('active');
                
                // Reset to round 1 after modal is closed
                modalOkBtn.onclick = function() {
                    successModal.classList.remove('active');
                    setTimeout(() => {
                        changeRound(1);
                        loadRound1();
                    }, 300);
                };
            });
            
            // Listen button for round 3
            document.getElementById('listen-btn').addEventListener('click', speakSentence);
            
            // Sentence navigation for round 3
            document.getElementById('prev-sentence-btn').addEventListener('click', function() {
                if (appData.currentSentenceIndex > 0) {
                    appData.currentSentenceIndex--;
                    loadRound3();
                }
            });
            
            document.getElementById('next-sentence-btn').addEventListener('click', function() {
                if (appData.currentSentenceIndex < appData.dictationSentences.length - 1) {
                    appData.currentSentenceIndex++;
                    loadRound3();
                }
            });
            
            // Listen button for round 5
            document.getElementById('listen-paragraph-btn').addEventListener('click', speakParagraph);
            
            // Stop button for round 5
            document.getElementById('stop-paragraph-btn').addEventListener('click', stopSpeech);
            
            // Pause/Resume button for round 5
            document.getElementById('pause-paragraph-btn').addEventListener('click', togglePauseSpeech);
            
            // Modal OK button
            modalOkBtn.addEventListener('click', function() {
                successModal.classList.remove('active');
            });
            
            // Close modals when clicking outside
            successModal.addEventListener('click', function(e) {
                if (e.target === successModal) {
                    successModal.classList.remove('active');
                }
            });
            
            skipModal.addEventListener('click', function(e) {
                if (e.target === skipModal) {
                    skipModal.classList.remove('active');
                    roundToSkip = null;
                }
            });
        }
        
        // Initialize the app when page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
